
[TOC]

## 使用继承带来的弊端

继承是面向对象的四大特性之一，用来表示类之间 is-a 关系，可以解决代码复用的问题。

继承层次过深、过复杂，会影响代码的可读性、可维护性。

定义抽象类时，关注多种行为，如果使用继承来实现，可能会组合爆炸。并且子类的实现依赖父类的实现，两者高度耦合，一旦父类修改代码，就会影响所有子类的逻辑。

继承最大的问题：**继承层次过深、继承关系过于复杂**，会影响代码的**可读性**和**可维护性**。


## 组合较继承的优势

可以使用组合（composition）、接口、委托（delegation）三个技术手段，来解决继承存在的问题。

接口，表示具有某种行为特性。但是只声明方法，不定义实现。对于实现类如果实现逻辑一样，会导致代码重复问题。
对于接口实现一个默认的实现类（或叫委托类 XxxAbility），然后在具体的实现类中通过组合和委托技术来消除代码重复。

```java
public interface Flyable {
  void fly();
}
public class FlyAbility implements Flyable {
  @Override
  public void fly() { //... }
}

public class Ostrich implements Tweetable, EggLayable {//鸵鸟
  private TweetAbility tweetAbility = new TweetAbility(); //组合
  private EggLayAbility eggLayAbility = new EggLayAbility(); //组合
  //... 省略其他属性和方法...
  @Override
  public void tweet() {
    tweetAbility.tweet(); // 委托
  }
  @Override
  public void layEgg() {
    eggLayAbility.layEgg(); // 委托
  }
}
```

继承主要3个作用：

1. 表示 is-a 关系
2. 支持多态特性
3. 代码复用

这3个作用可以通过其他技术手段来达成：

1. 通过组合和接口的 has-a 关系来替代，继承的 is-a 关系
2. 利用接口来实现，继承的多态特性
3. 通过组合和委托来实现，继承的代码复用

所以，从理论上，通过**组合、接口、委托**三个技术手段，完全可以替换掉继承，在项目中不用或少用继承关系，特别是一些复杂的继承关系。


## 组合继承最佳实践

鼓励多用组合少用继承，组合不是完美的，继承也不是一无是处。
继承改写成组合，意味着要做更细粒度的类的拆分，需要定义更多的类和接口，类和接口的增多或多或少地增加代码的复杂程度和维护成本。

1. 大的指导方针

    - 如果类之间的继承结构稳定（不会轻易变），继承层次比较浅（如最多2层继承关系），继承关系不复杂，可以大胆使用继承。
    - 反之，系统越不稳定，继承层次很深，继承关系复杂，尽量使用组合来替代继承。

2. 一些设计模式会固定使用继承或组合

    - 使用组合
        - 装饰者模式 decorator pattern
        - 策略模式 strategy pattern
        - 组合模式 composite pattern
    - 使用继承
        - 模板模式 template pattern

3. 业务含义上没有继承关系的，可以使用组合来实现，更加合理、更加灵活。

4. 必须使用继承的特殊场景

    - 如果不能改变一个函数的入参类型，并且入参不是接口，为了支持多态，只能采用继承来实现。

5. 总结

    - 组合并不完美，继承也不是一无是处。
    - **只要控制好副作用，发挥各自的优势，在不同的场景下，恰当地选择使用继承还是组合。**

